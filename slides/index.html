<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>üêç Python Packaging - Demystified üêç</title>

    <link rel="stylesheet" href="dist/reset.css" />
    <link rel="stylesheet" href="dist/reveal.css" />
    <link rel="stylesheet" href="dist/theme/black.css" id="theme" />
    <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme" />

    <meta name="theme-color" content="#ffffff" />
    <link rel="icon" href="img/package.svg" />
    <link rel="mask-icon" href="img/package.svg" color="#000000" />
  </head>
  <body>
    <style>
      /*set bloomberg logo*/
      @font-face {
        font-family: "Jetbrains Mono";
        src: url("./css/JetBrains\ Mono\ Regular\ Nerd\ Font\ Complete\ Mono.ttf");
      }
      .reveal code {
        font-family: "JetBrains Mono";
        font-size: 0.91em;
        line-height: 1.2;
      }
      body {
        background-image: url(img/bloomberg.svg) !important;
        background-size: 11% !important;
        background-repeat: no-repeat !important;
        background-position: 99.5% 99.5% !important;
      }
      mark {
        background-color: mediumseagreen;
      }
    </style>
    <div class="reveal">
      <div class="slides">
        <section>
          <h1 class="r-fit-text">Python Packaging</h1>
          <h1 class="r-fit-text">Demystified</h1>
          <h5>Tutorial - PyCon US 2021 - üåê edition</h5>
          <p>
            <small
              >by <a href="https://github.com/gaborbernat">Bernat Gabor</a> /
              <a href="https://twitter.com/gjbernat">@gjbernat</a> /
              <a href="https://github.com/bloomberg">Bloomberg</a>
            </small>
            <br />
            <a href="https://gaborbernat.github.io/pycon-us-2021-tutorial/"
              >https://gaborbernat.github.io/pycon-us-2021-tutorial</a
            >
          </p>
        </section>

        <section>
          <h3>Who am I?</h3>
          <div>
            <ul>
              <li class="fragment">software engineer at Bloomberg (data ingestion and quality control)</li>
              <li class="fragment">
                OSS contributor <a href="https://github.com/gaborbernat">gaborbernat@github</a> -
                <a href="https://bernat.tech">https://bernat.tech</a>
              </li>
              <li class="fragment">member of the Python Packaging Authority</li>
              <li class="fragment">üòé parent to two Yorkshire Terriers (Silky & Junior)</li>
            </ul>
            <div class="fragment">
              <img src="./img/silky_junior.png" class="r-stretch" />
              <p style="font-size: 0.1em; margin: 0 0">Copyright of the above image owned by Bernat Gabor</p>
            </div>
          </div>
        </section>

        <section>
          <h3>Maintainer (author *) of Python OSS projects</h3>
          <style>
            #maintain > tbody > tr > td {
              padding: 0.05em;
              max-height: 8%;
            }
            #maintain > tbody > tr > td > img,
            #maintain > tbody > tr > td > a > img {
              margin: 0;
              height: 1.6em;
            }
          </style>
          <table id="maintain">
            <thead>
              <tr>
                <th>Name</th>
                <th>Release</th>
                <th>Activity</th>
                <th>Popularity</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><a href="https://github.com/pypa/virtualenv">virtualenv *</a></td>
                <td>
                  <a href="https://pypi.org/project/virtualenv"
                    ><img src="https://img.shields.io/pypi/v/virtualenv?style=flat-square" alt="PyPI"
                  /></a>
                </td>
                <td>
                  <img
                    src="https://img.shields.io/github/last-commit/pypa/virtualenv?logo=python&amp;style=flat-square"
                    alt="GitHub last commit"
                  />
                </td>
                <td>
                  <a href="https://pypistats.org/packages/virtualenv"
                    ><img src="https://img.shields.io/pypi/dm/virtualenv?style=flat-square" alt="PyPI - Downloads" />
                  </a>
                </td>
              </tr>
              <tr>
                <td><a href="https://github.com/tox-dev/tox">tox *</a></td>
                <td>
                  <a href="https://pypi.org/project/tox"
                    ><img src="https://img.shields.io/pypi/v/tox?style=flat-square" alt="PyPI"
                  /></a>
                </td>
                <td>
                  <img
                    src="https://img.shields.io/github/last-commit/tox-dev/tox?logo=python&amp;style=flat-square"
                    alt="GitHub last commit"
                  />
                </td>
                <td>
                  <a href="https://pypistats.org/packages/tox"
                    ><img src="https://img.shields.io/pypi/dm/tox?style=flat-square" alt="PyPI - Downloads"
                  /></a>
                </td>
              </tr>
              <tr>
                <td><a href="https://github.com/pypa/build">build *</a></td>
                <td>
                  <a href="https://pypi.org/project/build"
                    ><img src="https://img.shields.io/pypi/v/build?style=flat-square" alt="PyPI"
                  /></a>
                </td>
                <td>
                  <img
                    src="https://img.shields.io/github/last-commit/pypa/build?logo=python&amp;style=flat-square"
                    alt="GitHub last commit"
                  />
                </td>
                <td>
                  <a href="https://pypistats.org/packages/build"
                    ><img src="https://img.shields.io/pypi/dm/build?style=flat-square" alt="PyPI - Downloads" />
                  </a>
                </td>
              </tr>
              <tr>
                <td><a href="https://github.com/pipxproject/pipx">pipx</a></td>
                <td>
                  <a href="https://pypi.org/project/pipx"
                    ><img src="https://img.shields.io/pypi/v/pipx?style=flat-square" alt="PyPI"
                  /></a>
                </td>
                <td>
                  <img
                    src="https://img.shields.io/github/last-commit/pipxproject/pipx?logo=python&amp;style=flat-square"
                    alt="GitHub last commit"
                  />
                </td>
                <td>
                  <a href="https://pypistats.org/packages/pipx"
                    ><img src="https://img.shields.io/pypi/dm/pipx?style=flat-square" alt="PyPI - Downloads" />
                  </a>
                </td>
              </tr>
              <tr>
                <td><a href="https://github.com/pytest-dev/pytest-print">pytest-print *</a></td>
                <td>
                  <a href="https://pypi.org/project/pytest-print"
                    ><img src="https://img.shields.io/pypi/v/pytest-print?style=flat-square" alt="PyPI"
                  /></a>
                </td>
                <td>
                  <img
                    src="https://img.shields.io/github/last-commit/pytest-dev/pytest-print?logo=python&amp;style=flat-square"
                    alt="GitHub last commit"
                  />
                </td>
                <td>
                  <a href="https://pypistats.org/packages/pytest-print"
                    ><img src="https://img.shields.io/pypi/dm/pytest-print?style=flat-square" alt="PyPI - Downloads" />
                  </a>
                </td>
              </tr>
              <tr>
                <td><a href="https://github.com/tox-dev/tox-conda">tox-conda</a></td>
                <td>
                  <a href="https://pypi.org/project/tox-conda"
                    ><img src="https://img.shields.io/pypi/v/tox-conda?style=flat-square" alt="PyPI"
                  /></a>
                </td>
                <td>
                  <img
                    src="https://img.shields.io/github/last-commit/tox-dev/tox-conda?logo=python&amp;style=flat-square"
                    alt="GitHub last commit"
                  />
                </td>
                <td>
                  <a href="https://pypistats.org/packages/tox-conda"
                    ><img src="https://img.shields.io/pypi/dm/tox-conda?style=flat-square" alt="PyPI - Downloads" />
                  </a>
                </td>
              </tr>
              <tr>
                <td><a href="https://github.com/bloomberg/attrs-strict">attrs-strict</a></td>
                <td>
                  <a href="https://pypi.org/project/attrs-strict"
                    ><img src="https://img.shields.io/pypi/v/attrs-strict?style=flat-square" alt="PyPI"
                  /></a>
                </td>
                <td>
                  <img
                    src="https://img.shields.io/github/last-commit/bloomberg/attrs-strict?logo=python&amp;style=flat-square"
                    alt="GitHub last commit"
                  />
                </td>
                <td>
                  <a href="https://pypistats.org/packages/attrs-strict"
                    ><img src="https://img.shields.io/pypi/dm/attrs-strict?style=flat-square" alt="PyPI - Downloads" />
                  </a>
                </td>
              </tr>
              <tr>
                <td><a href="https://github.com/gaborbernat/sphinx-argparse-cli">sphinx-argparse-cli *</a></td>
                <td>
                  <a href="https://pypi.org/project/sphinx-argparse-cli"
                    ><img src="https://img.shields.io/pypi/v/sphinx-argparse-cli?style=flat-square" alt="PyPI"
                  /></a>
                </td>
                <td>
                  <img
                    src="https://img.shields.io/github/last-commit/gaborbernat/sphinx-argparse-cli?logo=python&amp;style=flat-square"
                    alt="GitHub last commit"
                  />
                </td>
                <td>
                  <a href="https://pypistats.org/packages/sphinx-argparse-cli"
                    ><img
                      src="https://img.shields.io/pypi/dm/sphinx-argparse-cli?style=flat-square"
                      alt="PyPI - Downloads"
                    />
                  </a>
                </td>
              </tr>
              <tr>
                <td><a href="https://github.com/ambv/retype">retype</a></td>
                <td>
                  <a href="https://pypi.org/project/retype"
                    ><img src="https://img.shields.io/pypi/v/retype?style=flat-square" alt="PyPI"
                  /></a>
                </td>
                <td>
                  <img
                    src="https://img.shields.io/github/last-commit/ambv/retype?logo=python&amp;style=flat-square"
                    alt="GitHub last commit"
                  />
                </td>
                <td>
                  <a href="https://pypistats.org/packages/retype"
                    ><img src="https://img.shields.io/pypi/dm/retype?style=flat-square" alt="PyPI - Downloads" />
                  </a>
                </td>
              </tr>
              <tr>
                <td><a href="https://github.com/tox-dev/tox-ini-fmt">tox-ini-fmt *</a></td>
                <td>
                  <a href="https://pypi.org/project/tox-ini-fmt"
                    ><img src="https://img.shields.io/pypi/v/tox-ini-fmt?style=flat-square" alt="PyPI"
                  /></a>
                </td>
                <td>
                  <img
                    src="https://img.shields.io/github/last-commit/tox-dev/tox-ini-fmt?logo=python&amp;style=flat-square"
                    alt="GitHub last commit"
                  />
                </td>
                <td>
                  <a href="https://pypistats.org/packages/tox-ini-fmt"
                    ><img src="https://img.shields.io/pypi/dm/tox-ini-fmt?style=flat-square" alt="PyPI - Downloads" />
                  </a>
                </td>
              </tr>
            </tbody>
          </table>
        </section>

        <section>
          <h1>Chapter 1</h1>
          <h2>Distributing Python code</h2>
        </section>

        <section>
          <h2>Python code is easy to read (and write) üòÅ</h2>
          <h2 class="fragment">Shipping and running it to other machines is not üò≠</h2>
          <div class="fragment">
            <p>peoples face when they gaze into Python packaging first time</p>
            <figure>
              <img alt="why" class="r-stretch" src="./img/why.jpeg" />
              <figcaption>
                Photo by
                <a
                  href="https://unsplash.com/@marcuslcramer?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit"
                  >Marcus Cramer</a
                >
                /
                <a href="https://unsplash.com/?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit"
                  >Unsplash</a
                >
              </figcaption>
            </figure>
          </div>
        </section>

        <section>
          <h2 class="r-fit-text">The state of Python packaging</h2>
          <h5 style="color: cornflowerblue">From Python Packaging Authority point of view</h5>
          <div class="fragment">
            <ul>
              <li>Focus on Python only (think pypi.org and pip)</li>
              <li><b style="color: red">not</b> conda</li>
              <li><b style="color: red">not</b> your OS packaging system (DPKG/RPM/etc.)</li>
            </ul>
          </div>
        </section>

        <section>
          <h1 class="r-fit-text">A demo problem</h1>
          <div class="fragment">
            <h2>Calculating <span style="color: red">ùúã</span></h2>
            <p>ùúã is the ratio of a circle's circumference to its diameter</p>
            <figure>
              <img alt="why" class="r-stretch" src="./img/pi.svg" />
              <figcaption style="font-size: 0.5em">
                Photo by
                <a href="https://en.wikipedia.org/wiki/Pi#/media/File:Pi_eq_C_over_d.svg">Kjoonlee on Wikipedia</a>
                / Public Domain
              </figcaption>
            </figure>
          </div>
        </section>

        <section>
          <h2>Calculating <span style="color: red">ùúã</span></h2>
          <h3>The Gregory-Leibniz Series</h3>
          \[\begin{aligned} \frac{\pi}{4} &amp; = 1 - \frac{1}{3} + \frac{1}{5} - \frac{1}{7} + \frac{1}{9} - \cdots
          \end{aligned} \]
          <div class="fragment">
            \[\begin{aligned} \pi &amp; = \left(\frac{1}{1} - \frac{1}{3} + \frac{1}{5} - \frac{1}{7} + \frac{1}{9} -
            \cdots \right) \cdot 4 \end{aligned} \]
          </div>
          <p class="fragment">Not the fastest way (requires 300 iteration for first two precision)</p>
        </section>

        <section>
          <h2>Calculating <span style="color: red">ùúã</span></h2>
          <h3>The Gregory-Leibniz Series</h3>
          <div>
            \[\begin{aligned} \pi &amp; = \left(\frac{1}{1} - \frac{1}{3} + \frac{1}{5} - \frac{1}{7} + \frac{1}{9} -
            \cdots \right) \cdot 4 \end{aligned} \]
          </div>
          <pre><code style="max-height: 500px;" class="lang-python" data-trim data-noescape>
            # pi_approx.py
            from math import pi

            def approximate_pi(iteration_count: int) -> float:
                sign, result = 1, 0.0
                for at in range(iteration_count):
                    result += sign / (2 * at + 1)
                    sign *= -1
                return result * 4

            if __name__ == "__main__":
                approx_1, approx_2 = approximate_pi(300), approximate_pi(301)
                print(f"approx 300 {approx_1} with diff {approx_1 - pi}")
                print(f"approx 301 {approx_2} with diff {approx_2 - pi}")
            </code></pre>
          <pre class="fragment">
                                    <code class="lang-bash" data-trim data-noescape>
                      approx 300 3.1382593295155914 with diff -0.0033333240742017267
                      approx 301 3.1449149035588526 with diff 0.0033222499690594987
                </code>
            </pre>
        </section>

        <section>
          <h2>How to make it available on another machine?</h2>
          There are two ways to use the code:
          <div>
            <p style="text-align: left">from within Python (the developer way)</p>
            <pre><code class="lang-python" data-trim data-noescape>
                        $ python
                        Python 3.9.4 (default, Apr 12 2021, 09:53:36)
                        [Clang 12.0.0 (clang-1200.0.32.29)] on darwin
                        >>> from pi_approx import approximate_pi
                        >>> approximate_pi(300)
                        3.1382593295155914
                        </code></pre>
          </div>
          <div class="fragment">
            <p style="text-align: left">from the command line (as an executable - the end user way)</p>
            <pre><code class="lang-python" data-trim data-noescape>
                        $  python ./pi_approx.py
                        approx 300 3.1382593295155914 with diff -0.0033333240742017267
                        approx 301 3.1449149035588526 with diff 0.0033222499690594987
                        </code></pre>
          </div>
        </section>

        <section>
          <h2>How to make it available on another machine?</h2>
          There are two ways to use the code:
          <div>
            <p style="text-align: left">
              from within Python (the developer way) - <span style="color: red">library</span>
            </p>
            <pre><code class="lang-python" data-trim data-noescape>
                        $ python
                        Python 3.9.4 (default, Apr 12 2021, 09:53:36)
                        [Clang 12.0.0 (clang-1200.0.32.29)] on darwin
                        >>> from pi_approx import approximate_pi
                        >>> approximate_pi(300)
                        3.1382593295155914
                        </code></pre>
          </div>
          <div>
            <p style="text-align: left">
              from the command line (as an executable - the end user way) - <span style="color: red">application</span>
            </p>
            <pre><code class="lang-python" data-trim data-noescape>
                        $  python ./pi_approx.py
                        approx 300 3.1382593295155914 with diff -0.0033333240742017267
                        approx 301 3.1449149035588526 with diff 0.0033222499690594987
                        </code></pre>
          </div>
        </section>

        <section>
          <h2>How to make it available on another machine?</h2>
          There are two ways to use the code:
          <div>
            <p style="text-align: left">
              from within Python (the developer way) - <span style="color: red">library</span> -
              <span style="color: green">expose the source within a Python interpreter</span>
            </p>
            <pre><code class="lang-python" data-trim data-noescape>
                        $ python
                        Python 3.9.4 (default, Apr 12 2021, 09:53:36)
                        [Clang 12.0.0 (clang-1200.0.32.29)] on darwin
                        >>> from pi_approx import approximate_pi
                        >>> approximate_pi(300)
                        3.1382593295155914
                        </code></pre>
          </div>
          <div>
            <p style="text-align: left">
              from the command line (as an executable - the end user way) -
              <span stylef="color: red">application</span> - <span style="color: green">expose the logic</span>
            </p>
            <pre><code class="lang-python" data-trim data-noescape>
                $  python ./pi_approx.py
                approx 300 3.1382593295155914 with diff -0.0033333240742017267
                approx 301 3.1449149035588526 with diff 0.0033222499690594987
                </code></pre>
          </div>
        </section>

        <section>
          <h2>Application mode</h2>
          <h4>Allow user to run the code - closed system</h4>
          <ul>
            For example a Python GUI, CLI or web application; needs:
            <li class="fragment">A Python interpreter environment</li>
            <li class="fragment">Dependencies - exact version - may be obfuscated</li>
            <li class="fragment">The code - may be obfuscated</li>
            <li class="fragment">Entry point - how to invoke the execution</li>
          </ul>
        </section>

        <section>
          <h2>Library mode</h2>
          <h4>Allow user to interact with the code - open system</h4>
          <ul class="fragment">
            Needs:
            <li>A Python interpreter environment</li>
            <li class="fragment">Dependencies - compatible versions</li>
            <li class="fragment">The code</li>
          </ul>
        </section>

        <section>
          <h1>How to package a library</h1>
          <img src="./img/tennis.jpg" />
        </section>

        <section>
          <h3>What is a library</h3>
          <ul>
            code that can be
            <li><span style="color: red">imported</span> and executed</li>
            <li>from within a <span style="color: red">python interpreter</span></li>
          </ul>
        </section>

        <section>
          <h2>Python interpreter types</h2>
          <ul>
            <li>
              global or system one (as installed by the operating system package manager)
              <pre><code class="lang-python" data-trim data-noescape>
                $ python3.9 -c 'import sys; print(sys.executable)'
                C:\Users\gabor\AppData\Local\Programs\Python\Python39\python.exe
                </code></pre>
            </li>
            <li class="fragment">
              virtual environments - use system python executable and standard library, but isolate from other libraries
              <ul>
                <li class="fragment">
                  virtual environment - via <a href="https://docs.python.org/3/library/venv.html">venv</a>
                  <pre><code class="lang-python" data-trim data-noescape>
                  $ python3.9 -m venv env
  
                  $ .\env\Scripts\python.exe -c 'import sys; print(sys.executable)'
                  C:\Users\gabor\git\env\Scripts\python.exe
                 </code></pre>
                </li>
                <li class="fragment">
                  virtual environment - via <a href="https://virtualenv.pypa.io/en/latest">virtualenv</a>
                  <pre><code class="lang-python" data-trim data-noescape>
                  $ python3.9 -m virtualenv env
                  created virtual environment CPython3.9.4.final.0-64 in 475ms
                  creator CPython3Windows(dest=C:\Users\gabor\git\env, clear=True, no_vcs_ignore=False, global=False)
                  seeder FromAppData(download=False, pip=bundle, setuptools=bundle, wheel=bundle, via=copy, app_data_dir=C:\...\pypa\virtualenv)
                    added seed packages: pip==21.1, setuptools==56.0.0, wheel==0.36.2
                  activators BashActivator,BatchActivator,FishActivator,PowerShellActivator,PythonActivator,XonshActivator
  
                  $ .\env\Scripts\python.exe -c 'import sys; print(sys.executable)'
                  C:\Users\gabor\git\env\Scripts\python.exe
                 </code></pre>
                </li>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h2>Comparing virtual environment creators</h2>
          <table>
            <thead>
              <tr>
                <th></th>
                <th>virtualenv</th>
                <th>venv</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <span style="font-weight: bold">Installation</span>
                </td>
                <td>yes, third-party package</td>
                <td>no, standard library</td>
              </tr>
              <tr>
                <td>
                  <span style="font-weight: bold">Update</span>
                </td>
                <td>anytime via pip</td>
                <td>with the interpreter</td>
              </tr>
              <tr>
                <td>
                  <span style="font-weight: bold">Python version</span>
                </td>
                <td>
                  <span style="font-weight: 400; font-style: normal">2.7 and 3.4 or later</span>
                </td>
                <td>3.3 or later</td>
              </tr>
              <tr>
                <td>
                  <span style="font-weight: bold">Python flavour</span>
                </td>
                <td>PyPy, CPython</td>
                <td>self-support for 3.3+</td>
              </tr>
              <tr>
                <td>Configurability</td>
                <td>CLI + environment variables + per user config file</td>
                <td>CLI</td>
              </tr>
              <tr>
                <td>Extensibility</td>
                <td>via plugins that can be installed alongside</td>
                <td>by extending the base class</td>
              </tr>
              <tr>
                <td>Performance</td>
                <td>by using the cached seed mechanism &lt;500ms</td>
                <td>2 seconds+ per invocation</td>
              </tr>
              <tr>
                <td>API</td>
                <td>rich: e.g., lookup executable, site package dir</td>
                <td>
                  <a href="https://www.python.org/dev/peps/pep-0405/">limited as per PEP-405</a>
                </td>
              </tr>
            </tbody>
          </table>
        </section>

        <section>
          <h2>Performance difference</h2>
          <ul>
            measured via
            <a href="https://github.com/sharkdp/hyperfine">hyperfine</a>
            on Windows 10 with M2 disk (on UNIX around 2.5 faster)
            <li>
              venv
              <pre><code class="lang-python" data-trim data-noescape>
                $ hyperfine 'python3.9 -m venv env --clear'
                Benchmark #1: python3.9 -m venv env --clear
                0  Time (mean ¬± œÉ):      5.232 s ¬±  0.173 s    [User: 3.0 ms, System: 9.0 ms]
                0  Range (min ‚Ä¶ max):    4.990 s ‚Ä¶  5.520 s    10 runs
               </code></pre>
            </li>
            <li>
              virtualenv
              <pre><code class="lang-python" data-trim data-noescape>
                $ hyperfine 'python3.9 -m virtualenv env --clear'
                Benchmark #1: python3.9 -m virtualenv env --clear
                0  Time (mean ¬± œÉ):     672.2 ms ¬±  26.9 ms    [User: 4.4 ms, System: 8.5 ms]
                1  Range (min ‚Ä¶ max):   645.4 ms ‚Ä¶ 740.1 ms    10 runs
               </code></pre>
            </li>
          </ul>
        </section>

        <section>
          <h2>The library discovery system</h2>
          <ul>
            How does Python knows if a library is available (<a href="https://docs.python.org/3/reference/import.html"
              >import-able</a
            >)?
            <li class="fragment">
              It doesn't - "it's easier to ask for forgiveness than permission" - try to import and raise if fails
              <pre><code class="lang-python" data-trim data-noescape>
                $ virtualenv env
                $ .\env\Scripts\python.exe
                Python 3.9.4 (tags/v3.9.4:1f2e308, Apr  6 2021, 13:40:21) [MSC v.1928 64 bit (AMD64)] on win32
                Type "help", "copyright", "credits" or "license" for more information.
                >>> import setuptools
                >>> setuptools
                &lt;module 'setuptools' from 'C:\\Users\\gabor\\git\\env\\lib\\site-packages\\setuptools\\__init__.py'&gt;
               </code></pre>
            </li>
            <li class="fragment">
              setuptools here is a module - a dictionary of name to python objects groupped under a given name
              <pre><code class="lang-python" data-noescape>>>> dir(setuptools)[-3:]
['string_types', 'version', 'windows_support']








               </code></pre>
            </li>
          </ul>
        </section>

        <section>
          <h2>The library discovery system</h2>
          <ul>
            How does Python knows if a library is available (<a href="https://docs.python.org/3/reference/import.html"
              >import-able</a
            >)?
            <li>
              It doesn't - "it's easier to ask for forgiveness than permission" - try to import and raise if fails
              <pre><code class="lang-python" data-trim data-noescape>
                $ virtualenv env
                $ .\env\Scripts\python.exe
                Python 3.9.4 (tags/v3.9.4:1f2e308, Apr  6 2021, 13:40:21) [MSC v.1928 64 bit (AMD64)] on win32
                Type "help", "copyright", "credits" or "license" for more information.
                >>> import setuptools
                >>> setuptools
                &lt;module 'setuptools' from 'C:\\Users\\gabor\\git\\env\\lib\\site-packages\\setuptools\\__init__.py'&gt;
               </code></pre>
            </li>
            <li>
              setuptools here is a module - a dictionary of name to python objects groupped under a given name
              <pre><code class="lang-python" data-noescape>>>> dir(setuptools)[-3:]
['string_types', 'version', 'windows_support']

>>> setuptools.setup
&lt;function setup at 0x0000018C1A9660D0&gt;






</code></pre>
            </li>
          </ul>
        </section>

        <section>
          <h2>The library discovery system</h2>
          <ul>
            How does Python knows if a library is available (<a href="https://docs.python.org/3/reference/import.html"
              >import-able</a
            >)?
            <li>
              It doesn't - "it's easier to ask for forgiveness than permission" - try to import and raise if fails
              <pre><code class="lang-python" data-trim data-noescape>
                $ virtualenv env
                $ .\env\Scripts\python.exe
                Python 3.9.4 (tags/v3.9.4:1f2e308, Apr  6 2021, 13:40:21) [MSC v.1928 64 bit (AMD64)] on win32
                Type "help", "copyright", "credits" or "license" for more information.
                >>> import setuptools
                >>> setuptools
                &lt;module 'setuptools' from 'C:\\Users\\gabor\\git\\env\\lib\\site-packages\\setuptools\\__init__.py'&gt;
               </code></pre>
            </li>
            <li>
              setuptools here is a module - a dictionary of name to python objects groupped under a given name
              <pre><code class="lang-python" data-noescape>>>> dir(setuptools)[-3:]
['string_types', 'version', 'windows_support']

>>> setuptools.setup
&lt;function setup at 0x0000018C1A9660D0&gt;

>>> setuptools.string_types
(&lt;class 'str'&gt;,)



</code></pre>
            </li>
          </ul>
        </section>

        <section>
          <h2>The library discovery system</h2>
          <ul>
            How does Python knows if a library is available (<a href="https://docs.python.org/3/reference/import.html"
              >import-able</a
            >)?
            <li>
              It doesn't - "it's easier to ask for forgiveness than permission" - try to import and raise if fails
              <pre><code class="lang-python" data-trim data-noescape>
                $ virtualenv env
                $ .\env\Scripts\python.exe
                Python 3.9.4 (tags/v3.9.4:1f2e308, Apr  6 2021, 13:40:21) [MSC v.1928 64 bit (AMD64)] on win32
                Type "help", "copyright", "credits" or "license" for more information.
                >>> import setuptools
                >>> setuptools
                &lt;module 'setuptools' from 'C:\\Users\\gabor\\git\\env\\lib\\site-packages\\setuptools\\__init__.py'&gt;
               </code></pre>
            </li>
            <li>
              setuptools here is a module - a dictionary of name to python objects groupped under a given name
              <pre><code class="lang-python" data-noescape>>>> dir(setuptools)[-3:]
['string_types', 'version', 'windows_support']

>>> setuptools.setup
&lt;function setup at 0x0000018C1A9660D0&gt;

>>> setuptools.string_types
(&lt;class 'str'&gt;,)

>>> setuptools.version
&lt;module 'setuptools.version' from 'C:\\Users\\gabor\\AppData\\...\\Python39\\lib\\site-packages\\setuptools\\version.py'&gt;</code></pre>
            </li>
          </ul>
        </section>

        <section>
          <h1>from imports</h1>

          <p>A from import is just syntactic sugar for a module import and then an assigment</p>

          <pre><code class="lang-python" data-noescape data-trim>
          >>> from setuptools import setup
          </code></pre>

          <pre><code class="lang-python" data-noescape data-trim>
            >>> import setuptools
            >>> setup = setuptools.setup
            >>> del locals()["setuptools"]
            </code></pre>
        </section>

        <section>
          <h2>not all modules are equal</h2>
          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.

<div class="fragment">>>> import sys
>>> sys
  &lt;module 'sys' (built-in)&gt;</div>
<div class="fragment">>>> import os
>>> os
  &lt;module 'os' from '/opt/python3.9/lib/python3.9/os.py'&gt;</div>
<div class="fragment">>>> import _csv
>>> _csv
&lt;module '_csv' from '/opt/python3.9/lib/python3.9/lib-dynload/_csv.cpython-39dm-darwin.so'&gt;</div>
<div class="fragment">>>> import pytoml
>>> pytoml
&lt;module 'pytoml' from '/opt/python3.9/lib/python3.9/site-packages/pytoml/__init__.py'&gt;</div>
<div class="fragment">>>> import pep517
>>> pep517
  &lt;module 'pep517' from '/Users/bernat/.local/lib/python3.9/site-packages/pep517/__init__.py'&gt;</div><br></code>
                  </pre>
        </section>

        <section>
          <h2>not all modules are equal</h2>
          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.

<mark>>>> import sys
>>> sys
  &lt;module 'sys' (built-in)&gt;</mark>
<span style="color: black; background-color: cyan"><b>builtin module</b></span>
<div>>>> import os
>>> os
  &lt;module 'os' from '/opt/python3.9/lib/python3.9/os.py'&gt;</div>
<div>>>> import _csv
>>> _csv
&lt;module '_csv' from '/opt/python3.9/lib/python3.9/lib-dynload/_csv.cpython-39dm-darwin.so'&gt;</div>
<div>>>> import pytoml
>>> pytoml
&lt;module 'pytoml' from '/opt/python3.9/lib/python3.9/site-packages/pytoml/__init__.py'&gt;</div>
<div>>>> import pep517
>>> pep517
  &lt;module 'pep517' from '/Users/bernat/.local/lib/python3.9/site-packages/pep517/__init__.py'&gt;</div><br></code>
                  </pre>
        </section>

        <section>
          <h2>not all modules are equal</h2>
          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.

<div>>>> import sys
>>> sys
  &lt;module 'sys' (built-in)&gt;</div>
<mark>>>> import os
>>> os
  &lt;module 'os' from '/opt/python3.9/lib/python3.9/os.py'&gt;</mark>
<span style="color: black; background-color: cyan"><b>standard library module</b></span>
<div>>>> import _csv
>>> _csv
&lt;module '_csv' from '/opt/python3.9/lib/python3.9/lib-dynload/_csv.cpython-39dm-darwin.so'&gt;</div>
<div>>>> import pytoml
>>> pytoml
&lt;module 'pytoml' from '/opt/python3.9/lib/python3.9/site-packages/pytoml/__init__.py'&gt;</div>
<div>>>> import pep517
>>> pep517
  &lt;module 'pep517' from '/Users/bernat/.local/lib/python3.9/site-packages/pep517/__init__.py'&gt;</div><br></code>
                  </pre>
        </section>

        <section>
          <h2>not all modules are equal</h2>
          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.

<div>>>> import sys
>>> sys
  &lt;module 'sys' (built-in)&gt;</div>
<div>>>> import os
>>> os
  &lt;module 'os' from '/opt/python3.9/lib/python3.9/os.py'&gt;</div>
<mark>>>> import _csv
>>> _csv
&lt;module '_csv' from '/opt/python3.9/lib/python3.9/lib-dynload/_csv.cpython-39dm-darwin.so'&gt;</mark>
<span style="color: black; background-color: cyan"><b>standard library dynamic load module</b></span>
<div>>>> import pytoml
>>> pytoml
&lt;module 'pytoml' from '/opt/python3.9/lib/python3.9/site-packages/pytoml/__init__.py'&gt;</div>
<div>>>> import pep517
>>> pep517
  &lt;module 'pep517' from '/Users/bernat/.local/lib/python3.9/site-packages/pep517/__init__.py'&gt;</div><br></code>
                  </pre>
        </section>

        <section>
          <h2>not all modules are equal</h2>
          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.

<div>>>> import sys
>>> sys
  &lt;module 'sys' (built-in)&gt;</div>
<div>>>> import os
>>> os
  &lt;module 'os' from '/opt/python3.9/lib/python3.9/os.py'&gt;</div>
<div>>>> import _csv
>>> _csv
&lt;module '_csv' from '/opt/python3.9/lib/python3.9/lib-dynload/_csv.cpython-39dm-darwin.so'&gt;</div>
<mark>>>> import pytoml
>>> pytoml
&lt;module 'pytoml' from '/opt/python3.9/lib/python3.9/site-packages/pytoml/__init__.py'&gt;</mark>
<span style="color: black; background-color: cyan"><b>global site package module -> python -m pip install</b></span>
<div>>>> import pep517
>>> pep517
  &lt;module 'pep517' from '/Users/bernat/.local/lib/python3.9/site-packages/pep517/__init__.py'&gt;</div><br></code>
                  </pre>
        </section>

        <section>
          <h2>not all modules are equal</h2>
          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.

<div>>>> import sys
>>> sys
  &lt;module 'sys' (built-in)&gt;</div>
<div>>>> import os
>>> os
  &lt;module 'os' from '/opt/python3.9/lib/python3.9/os.py'&gt;</div>
<div>>>> import _csv
>>> _csv
&lt;module '_csv' from '/opt/python3.9/lib/python3.9/lib-dynload/_csv.cpython-39dm-darwin.so'&gt;</div>
<div>>>> import pytoml
>>> pytoml
&lt;module 'pytoml' from '/opt/python3.9/lib/python3.9/site-packages/pytoml/__init__.py'&gt;</div>
<mark>>>> import pep517
>>> pep517
  &lt;module 'pep517' from '/Users/bernat/.local/lib/python3.9/site-packages/pep517/__init__.py'&gt;</mark>
<span style="color: black; background-color: cyan"><b>user site package module -> python -m pip install --user</b></span></code>
                  </pre>
        </section>

        <section>
          <h2>the import system - importers</h2>
          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
>>> import sys
</code>
                  </pre>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
                    
>>> import sys
>>> for importer in sys.meta_path:
...     print(repr(importer))
...
&lt;class '_frozen_importlib.BuiltinImporter'&gt;
&lt;class '_frozen_importlib.FrozenImporter'&gt;
&lt;class '_frozen_importlib_external.PathFinder'&gt;
</code>
                  </pre>
        </section>

        <section>
          <h2>the import system - built-in</h2>
          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
>>> import sys
</code>
                  </pre>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
                    
>>> import sys
>>> for importer in sys.meta_path:
...     print(repr(importer))
...
<mark>&lt;class '_frozen_importlib.BuiltinImporter'&gt;</mark>
&lt;class '_frozen_importlib.FrozenImporter'&gt;
&lt;class '_frozen_importlib_external.PathFinder'&gt;
</code>
                  </pre>
        </section>

        <section>
          <h2>the import system - frozen</h2>

          <p>
            <a href="https://wiki.python.org/moin/Freeze">freeze tool</a>,
            <a href="https://pyinstaller.readthedocs.io/en/v3.3.1/when-things-go-wrong.html">pyinstaller</a>, etc.
          </p>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
                    
>>> import sys
>>> for importer in sys.meta_path:
...     print(repr(importer))
...
&lt;class '_frozen_importlib.BuiltinImporter'&gt;
<mark>&lt;class '_frozen_importlib.FrozenImporter'&gt;</mark>
&lt;class '_frozen_importlib_external.PathFinder'&gt;
</code>
                  </pre>
        </section>

        <section>
          <h2>the import system - path finder</h2>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
>>> import os
</code>
                  </pre>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
                    
>>> import sys
>>> for importer in sys.meta_path:
...     print(repr(importer))
...
&lt;class '_frozen_importlib.BuiltinImporter'&gt;
&lt;class '_frozen_importlib.FrozenImporter'&gt;
<mark>&lt;class '_frozen_importlib_external.PathFinder'&gt;</mark>
</code> </pre>
        </section>

        <section>
          <h2>the import system - path finder</h2>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
>>> import os

<mark>&lt;class '_frozen_importlib_external.PathFinder'&gt;</mark>
</code>
                  </pre>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
                    
>>> import sys
>>> for path in sys.path:
...     print(repr(path))
...
/opt/python3.9/lib/python39.zip
/opt/python3.9/lib/python3.9
/opt/python3.9/lib/python3.9/lib-dynload
/Users/bernat/.local/lib/python3.9/site-packages
/opt/python3.9/lib/python3.9/site-packages
</code> </pre>
        </section>

        <section>
          <h2>the import system - path finder</h2>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
>>> import os

<mark>&lt;class '_frozen_importlib_external.PathFinder'&gt;</mark>
</code>
                  </pre>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
                    
>>> import sys
>>> for path in sys.path:
...     print(repr(path))
...
<mark>/opt/python3.9/lib/python39.zip</mark> <span style="color: black; background-color: cyan">standard library zipped</span>
/opt/python3.9/lib/python3.9
/opt/python3.9/lib/python3.9/lib-dynload
/Users/bernat/.local/lib/python3.9/site-packages
/opt/python3.9/lib/python3.9/site-packages
</code> </pre>
        </section>

        <section>
          <h2>the import system - path finder</h2>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
>>> import os
&lt;module 'os' from '/opt/python3.9/lib/python3.9/os.py'&gt;
<mark>&lt;class '_frozen_importlib_external.PathFinder'&gt;</mark>
</code>
                  </pre>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.

>>> import sys
>>> for path in sys.path:
...     print(repr(path))
...
/opt/python3.9/lib/python39.zip
<mark>/opt/python3.9/lib/python3.9</mark> <span style="color: black; background-color: cyan">standard library directory</span>
/opt/python3.9/lib/python3.9/lib-dynload
/Users/bernat/.local/lib/python3.9/site-packages
/opt/python3.9/lib/python3.9/site-packages
</code> </pre>
        </section>

        <section>
          <h2>the import system - path finder</h2>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
>>> import _csv
&lt;module '_csv' from '/opt/python3.9/lib/python3.9/lib-dynload/_csv.cpython-39dm-darwin.so'&gt;
<mark>&lt;class '_frozen_importlib_external.PathFinder'&gt;</mark>
</code>
                  </pre>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.

>>> import sys
>>> for path in sys.path:
...     print(repr(path))
...
/opt/python3.9/lib/python39.zip
/opt/python3.9/lib/python3.9
<mark>/opt/python3.9/lib/python3.9/lib-dynload</mark> <span style="color: black; background-color: cyan">standard library c-extensions</span>
/Users/bernat/.local/lib/python3.9/site-packages
/opt/python3.9/lib/python3.9/site-packages
</code> </pre>
        </section>

        <section>
          <h2>the import system - path finder</h2>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
>>> import pytoml
&lt;module 'pytoml' from '/opt/python3.9/lib/python3.9/site-packages/pytoml/__init__.py'&gt;
<mark>&lt;class '_frozen_importlib_external.PathFinder'&gt;</mark>
</code>
                  </pre>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.

>>> import sys
>>> for path in sys.path:
...     print(repr(path))
...
/opt/python3.9/lib/python39.zip
/opt/python3.9/lib/python3.9
/opt/python3.9/lib/python3.9/lib-dynload
<mark>/Users/bernat/.local/lib/python3.9/site-packages</mark> <span
                          style="color: black; background-color: cyan">user site package</span>
/opt/python3.9/lib/python3.9/site-packages
</code> </pre>
        </section>

        <section>
          <h2>the import system - path finder</h2>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
>>> pep517
&lt;module 'pep517' from '/Users/bernat/.local/lib/python3.9/site-packages/pep517/__init__.py'&gt;
<mark>&lt;class '_frozen_importlib_external.PathFinder'&gt;</mark>
</code></pre>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.

>>> import sys
>>> for path in sys.path:
...     print(repr(path))
...
/opt/python3.9/lib/python39.zip
/opt/python3.9/lib/python3.9
/opt/python3.9/lib/python3.9/lib-dynload
/Users/bernat/.local/lib/python3.9/site-packages
<mark>/opt/python3.9/lib/python3.9/site-packages</mark> <span style="color: black; background-color: cyan">global site package</span>
</code></pre>
        </section>

        <section>
          <h2>What is a virtual environment? - <a href="https://www.python.org/dev/peps/pep-0405/">PEP-405</a></h2>
          <ul>
            <i>isolated Python environment</i>
            <div>
              <li>access to its own site-package</li>
              <li>
                <b>shares access to host</b>
                <ul>
                  <li>built-ins</li>
                  <li>standard library</li>
                </ul>
              </li>
              <li>optionally isolated from the system site package</li>
            </div>
          </ul>
        </section>

        <section>
          <h4>System python paths</h4>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
>>> import sys
>>> sys.executable
/opt/python3.9/bin/python
</code>
                  </pre>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape>Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.

>>> import sys
>>> for path in sys.path:
...     print(repr(path))
...
<mark>/opt/python3.9/lib/python39.zip</mark> <span style="color: black; background-color: cyan">standard library zipped</span>
<mark>/opt/python3.9/lib/python3.9</mark> <span
                          style="color: black; background-color: cyan">standard library</span>
<mark>/opt/python3.9/lib/python3.9/lib-dynload</mark> <span style="color: black; background-color: cyan">standard library c-extension</span>

<mark>/Users/bernat/.local/lib/python3.9/site-packages</mark> <span
                          style="color: black; background-color: cyan">user site package</span>
<mark>/opt/python3.9/lib/python3.9/site-packages</mark> <span style="color: black; background-color: cyan">global site package</span>
</code> </pre>
        </section>

        <section>
          <h4>virtual environment python paths - no global access</h4>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
>>> import sys
>>> sys.executable
/Users/bernat/env/bin/python
</code>
                  </pre>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape>Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.

>>> import sys
>>> for path in sys.path:
...     print(repr(path))
...
<mark>/opt/python3.9/lib/python39.zip</mark> <span style="color: black; background-color: cyan">standard library zipped</span>
<mark>/opt/python3.9/lib/python3.9</mark> <span
                          style="color: black; background-color: cyan">standard library</span>
<mark>/opt/python3.9/lib/python3.9/lib-dynload</mark> <span style="color: black; background-color: cyan">standard library c-extension</span>
<mark>/Users/bernat/env/lib/python3.9/site-package</mark> <span style="color: black; background-color: cyan">OWN site package</span>


</code> </pre>
        </section>

        <section>
          <h4>virtual environment python paths - global access</h4>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
>>> import sys
>>> sys.executable
/Users/bernat/env/bin/python
</code>
                  </pre>

          <pre style="font-size: 0.55em; width: 60em">
                  <code style="max-height: 30em" class="lang-python" data-noescape data-trim>
Python 3.9.4 (default, Apr 10 2021, 15:31:19)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.

>>> import sys
>>> for path in sys.path:
...     print(repr(path))
...
<mark>/opt/python3.9/lib/python39.zip</mark> <span style="color: black; background-color: cyan">standard library zipped</span>
<mark>/opt/python3.9/lib/python3.9</mark> <span
                          style="color: black; background-color: cyan">standard library</span>
<mark>/opt/python3.9/lib/python3.9/lib-dynload</mark> <span style="color: black; background-color: cyan">standard library c-extension</span>
<mark>/Users/bernat/env/lib/python3.9/site-package</mark> <span style="color: black; background-color: cyan">OWN site package</span>
<mark>/Users/bernat/.local/lib/python3.9/site-packages</mark> <span
                          style="color: black; background-color: cyan">user site package</span>
<mark>/opt/python3.9/lib/python3.9/site-packages</mark> <span style="color: black; background-color: cyan">global site package</span>
</code> </pre>
        </section>

        <section>
          <h2>site-packages == purelib + platlib</h2>
          Python defines two folders as python library locations, often set to same
          <pre>
              <code style="max-height: 800px;" class="lang-python" data-trim data-noescape>
                Python 3.9.4 (default, Apr  6 2021, 00:00:00)
                [GCC 11.0.1 20210324 (Red Hat 11.0.1-0)] on linux

                >>> import sys, sysconfig

                >>> sysconfig.get_path('platlib')
                '/env/lib64/python3.9/site-packages'

                >>> sysconfig.get_path('purelib')
                '/env/lib/python3.9/site-packages'

                >>> print('\n'.join(sys.path))
                /usr/lib64/python39.zip
                /usr/lib64/python3.9
                /usr/lib64/python3.9/lib-dynload
                <mark>/env/lib64/python3.9/site-packages</mark>
                <mark>/env/lib/python3.9/site-packages</mark>
              </code>
          </pre>
        </section>

        <section>
          <h2>What is an installed library made of?</h2>
          <ul>
            <li>
              the code itself - a module or package
              <pre><code class="lang-python" data-trim data-noescape>
                  ‚ùØ lsd C:\Users\gabor\git\env\lib\site-packages\setuptools --tree
                  ÔÑï setuptools <mark><- package</mark>
                  ‚îú‚îÄ‚îÄ ÓòÜ __init__.py <mark><- module</mark>
                  ...
                  ‚îú‚îÄ‚îÄ ÓòÜ build_meta.py
                  ‚îú‚îÄ‚îÄ ÔÖ∫ cli-32.exe<mark><- resource file</mark>
                  ...
                  ‚îî‚îÄ‚îÄ ÓòÜ windows_support.py
              </code></pre>
            </li>
            <li class="fragment">
              entry points - console/GUI generated alongside the python executable
              <pre>
              <code class="lang-python" data-trim data-noescape>
                ‚ùØ lsd --tree .\env\Scripts
                ÔÑï Scripts
                ‚îú‚îÄ‚îÄ ÔÖ∫ pip-3.9.exe
                ‚îú‚îÄ‚îÄ ÔÖ∫ pip.exe
                ‚îú‚îÄ‚îÄ ÔÖ∫ pip3.9.exe
                ‚îî‚îÄ‚îÄ ÔÖ∫ pip3.exe
              </code></pre>
            </li>
            <li class="fragment">
              metadata declaring the package by/for the installer - mostly as defined by
              <a href="https://www.python.org/dev/peps/pep-0427/">PEP-427</a>
              <pre>
                <code class="lang-python" data-trim data-noescape>
                  ‚ùØ lsd C:\Users\gabor\git\env\lib\site-packages\setuptools-56.0.0.dist-info --tree
                  ÔÑï setuptools-56.0.0.dist-info
                  ‚îú‚îÄ‚îÄ ÔÖú dependency_links.txt
                  ‚îú‚îÄ‚îÄ ÔÖú entry_points.txt
                  ‚îú‚îÄ‚îÄ ÔÄñ INSTALLER
                  ‚îú‚îÄ‚îÄ ÔÄñ LICENSE
                  ‚îú‚îÄ‚îÄ ÔÄñ METADATA
                  ‚îú‚îÄ‚îÄ ÔÄñ RECORD
                  ‚îú‚îÄ‚îÄ ÔÖú top_level.txt
                  ‚îî‚îÄ‚îÄ ÔÄñ WHEEL
                </code>
            </pre>
            </li>
          </ul>
        </section>

        <section>
          <h2>What would it mean to be able to run our pi logic?</h2>
          <pre><code class="lang-python" data-trim data-noescape>
            $ python
            Python 3.9.4 (default, Apr 12 2021, 09:53:36)
            [Clang 12.0.0 (clang-1200.0.32.29)] on darwin
            >>> from pi_approx import approximate_pi
            >>> approximate_pi(300)
            3.1382593295155914
            </code></pre>

          <pre class="fragment"><code class="lang-python" data-trim data-noescape>
            # pi_approx.py
            from math import pi

            def approximate_pi(iteration_count: int) -> float:
                sign, result = 1, 0.0
                for at in range(iteration_count):
                    result += sign / (2 * at + 1)
                    sign *= -1
                return result * 4
            </code></pre>
          <pre class="fragment">
                <code class="lang-python" data-trim data-noescape>
                  ‚ùØ lsd .\env\Lib\site-packages\pi_approx* --tree
                  ÓòÜ pi_approx.py
                  ÔÑï pi_approx-1.0.dist-info
                  ‚îú‚îÄ‚îÄ Óòã direct_url.json
                  ‚îú‚îÄ‚îÄ ÔÄñ INSTALLER
                  ‚îú‚îÄ‚îÄ ÔÄñ LICENSE
                  ‚îú‚îÄ‚îÄ ÔÄñ METADATA
                  ‚îú‚îÄ‚îÄ ÔÄñ RECORD
                  ‚îú‚îÄ‚îÄ ÔÄñ REQUESTED
                  ‚îî‚îÄ‚îÄ ÔÄñ WHEEL
                </code>
                </pre>
        </section>

        <section>
          <h5>What is a python project made of?</h5>
          <pre>
                <code class="lang-python" data-noescape>ÔÑï project
‚îî‚îÄ‚îÄ ÓòÜ pi_approx.py <mark>business logic file(s)</mark>







                </code>
            </pre>
        </section>
        <section>
          <h5>What is a python project made of?</h5>
          <pre>
                <code class="lang-python" data-noescape>ÔÑï project
‚îú‚îÄ‚îÄ ÓòÜ pi_approx.py
‚îî‚îÄ‚îÄ ÓòÜ test_pi_approx.py <mark>test file(s)</mark>






                </code>
            </pre>
        </section>
        <section>
          <h5>What is a python project made of?</h5>
          <pre>
                <code class="lang-python" data-noescape>ÔÑï project
‚îú‚îÄ‚îÄ ÓòÜ pi_approx.py
‚îú‚îÄ‚îÄ ÓòÜ test_pi_approx.py
‚îú‚îÄ‚îÄ ÓòÜ LICENSE <mark>project management file(s)</mark>
‚îú‚îÄ‚îÄ Ôíä README.md
‚îî‚îÄ‚îÄ .github
    ‚îî‚îÄ‚îÄ ÔÑï workflows
        ‚îî‚îÄ‚îÄ Óòã check.yaml

                </code>
            </pre>
        </section>

        <section>
          <h5>What is a python project made of?</h5>
          <pre>
                <code class="lang-python" data-noescape>ÔÑï project
‚îú‚îÄ‚îÄ ÓòÜ pi_approx.py
‚îú‚îÄ‚îÄ ÓòÜ test_pi_approx.py
‚îú‚îÄ‚îÄ ÓòÜ LICENSE
‚îú‚îÄ‚îÄ Ôíä README.md
‚îú‚îÄ‚îÄ .github
‚îÇ   ‚îî‚îÄ‚îÄ ÔÑï workflows
‚îÇ       ‚îî‚îÄ‚îÄ Óòã check.yaml
‚îî‚îÄ‚îÄ ÔÄñ pyproject.toml <mark>project packaging file(s)</mark>
                </code>
            </pre>
        </section>

        <section>
          <h5>What is a python project made of?</h5>
          <ul>
            <li>
              layout on our development machine
              <pre>
                <code class="lang-python" data-noescape>ÔÑï project
‚îú‚îÄ‚îÄ ÓòÜ pi_approx.py
‚îú‚îÄ‚îÄ ÓòÜ test_pi_approx.py
‚îú‚îÄ‚îÄ ÓòÜ LICENSE
‚îú‚îÄ‚îÄ Ôíä README.md
‚îú‚îÄ‚îÄ .github
‚îÇ   ‚îî‚îÄ‚îÄ ÔÑï workflows
‚îÇ       ‚îî‚îÄ‚îÄ Óòã check.yaml
‚îî‚îÄ‚îÄ ÔÄñ pyproject.toml
                </code>
            </pre>
            </li>
            <li>
              layout on their machine - the run environment
              <pre>
                <code class="lang-python" data-trim data-noescape>
                  ‚ùØ lsd .\env\Lib\site-packages\pi_approx* --tree
                  ÓòÜ pi_approx.py
                  ÔÑï pi_approx-1.0.dist-info
                  ‚îú‚îÄ‚îÄ Óòã direct_url.json
                  ‚îú‚îÄ‚îÄ ÔÄñ INSTALLER
                  ‚îú‚îÄ‚îÄ ÔÄñ LICENSE
                  ‚îú‚îÄ‚îÄ ÔÄñ METADATA
                  ‚îú‚îÄ‚îÄ ÔÄñ RECORD
                  ‚îú‚îÄ‚îÄ ÔÄñ REQUESTED
                  ‚îî‚îÄ‚îÄ ÔÄñ WHEEL
                </code>
                </pre>
            </li>
          </ul>
        </section>

        <section>
          <h5>What is a python project made of?</h5>
          <ul>
            <li>
              layout on our development machine
              <pre>
                <code class="lang-python" data-noescape>ÔÑï project
‚îú‚îÄ‚îÄ ÓòÜ <mark>pi_approx.py</mark>
‚îú‚îÄ‚îÄ ÓòÜ test_pi_approx.py
‚îú‚îÄ‚îÄ ÓòÜ LICENSE
‚îú‚îÄ‚îÄ Ôíä README.md
‚îú‚îÄ‚îÄ .github
‚îÇ   ‚îî‚îÄ‚îÄ ÔÑï workflows
‚îÇ       ‚îî‚îÄ‚îÄ Óòã check.yaml
‚îî‚îÄ‚îÄ ÔÄñ pyproject.toml
                </code>
            </pre>
            </li>
            <li>
              layout on their machine - the run environment
              <pre>
                <code class="lang-python" data-trim data-noescape>
                  ‚ùØ lsd .\env\Lib\site-packages\pi_approx* --tree
                  <mark>ÓòÜ pi_approx.py</mark>
                  ÔÑï pi_approx-1.0.dist-info
                  ‚îú‚îÄ‚îÄ Óòã direct_url.json
                  ‚îú‚îÄ‚îÄ ÔÄñ INSTALLER
                  ‚îú‚îÄ‚îÄ ÔÄñ LICENSE
                  ‚îú‚îÄ‚îÄ ÔÄñ METADATA
                  ‚îú‚îÄ‚îÄ ÔÄñ RECORD
                  ‚îú‚îÄ‚îÄ ÔÄñ REQUESTED
                  ‚îî‚îÄ‚îÄ ÔÄñ WHEEL
                </code>
                </pre>
            </li>
          </ul>
        </section>

        <section>
          <h5>Shipping code to another machine</h5>
          <!-- prettier-ignore -->
          <!--  https://mermaid-js.github.io/mermaid-live-editor
            graph LR
              A["Developer source tree üñø"] --- B>"package üì¶"]
              B .-> C["Target machine üñø"]
          -->
          <img width="80%" data-src="img/dev_pkg_target.svg" />
          <!-- prettier-ignore -->
          <!--  https://mermaid-js.github.io/mermaid-live-editor
          graph LR
            A["Developer source tree üñø"] .- B>"package üì¶"]
            B .-> U[("Centeral Package Store üßÄ")]
            U .-> D>"package üì¶"]
            D .-> C["Target machine üñø"]
          -->
          <img class="fragment" width="80%" data-src="img/dev_pkg_via_central_target.svg" />
        </section>

        <section>
          <h2>Package types - (<span style="color: red">sdist</span>)</h2>
          <p>source distribution - resembles what we have on the developer machine</p>
          <ul>
            <li style="color: red">all the files needed to install (and test) a package from raw source</li>
            <li class="fragment">
              source tree minus
              <ul>
                <li>project management files</li>
                <li>maintainer files</li>
              </ul>
            </li>
            <li class="fragment">has business logic, packaging, tests</li>
          </ul>
          <pre class="fragment">
              <code class="lang-python" data-noescape>ÔÑï project
‚îú‚îÄ‚îÄ ÓòÜ <mark>pi_approx.py</mark>
‚îú‚îÄ‚îÄ ÓòÜ <mark>test_pi_approx.py</mark>
‚îú‚îÄ‚îÄ ÓòÜ <mark>LICENSE</mark>
‚îú‚îÄ‚îÄ Ôíä <mark>README.md</mark>
‚îú‚îÄ‚îÄ .github
‚îÇ   ‚îî‚îÄ‚îÄ ÔÑï workflows
‚îÇ       ‚îî‚îÄ‚îÄ Óòã check.yaml
‚îî‚îÄ‚îÄ ÔÄñ <mark>pyproject.toml</mark>
              </code>
          </pre>
        </section>

        <section>
          <h2>Package types - <span style="color: red">wheel</span></h2>
          <p>resembles what we want on the target machine</p>
          <ul>
            <li>
              <span style="color: red">the installed binary files with some meta data</span>
            </li>
            <li class="fragment">
              source tree minus
              <ul>
                <li>project management files</li>
                <li>maintainer files</li>
                <li>tests</li>
                <li>packaging files</li>
              </ul>
            </li>
          </ul>

          <pre class="fragment">
            <code class="lang-python" data-trim data-noescape>
              ‚ùØ lsd .\env\Lib\site-packages\pi_approx* --tree
              <mark>ÓòÜ pi_approx.py</mark>
              ÔÑï pi_approx-1.0.dist-info
              ‚îú‚îÄ‚îÄ Óòã direct_url.json
              ‚îú‚îÄ‚îÄ ÔÄñ INSTALLER
              ‚îú‚îÄ‚îÄ ÔÄñ LICENSE
              ‚îú‚îÄ‚îÄ ÔÄñ METADATA
              ‚îú‚îÄ‚îÄ ÔÄñ RECORD
              ‚îú‚îÄ‚îÄ ÔÄñ REQUESTED
              ‚îî‚îÄ‚îÄ ÔÄñ WHEEL
            </code>
            </pre>
        </section>

        <section>
          <h2>sdist or wheel</h2>
          <ul>
            <li>We always install wheel - if we have a sdist we first build a wheel from it</li>
          </ul>
        </section>

        <section>
          <h2>Breaking down shipping a library</h2>
          <h5 style="color: lightskyblue">Generate a package</h5>
          <!-- prettier-ignore -->
          <!--  https://mermaid-js.github.io/mermaid-live-editor
          graph LR
            A["Developer source tree üñø"] .-> B(["Build a package"])
            B .-> C["package üì¶"]
            C .-> D(["upload package"])
            D .-> U[("Centeral Package Store üßÄ")]
          -->
          <img width="60%" data-src="img/generate_package.svg" />
          <div class="fragment">
            <h5 style="color: lightskyblue">Consume a package</h5>
            <!-- prettier-ignore -->
            <!--  https://mermaid-js.github.io/mermaid-live-editor
          graph LR
            U[("Centeral Package Store üßÄ")] .-> A["package üì¶"]
            A .-> B(["Discover & download package"])
            B .-> E{is wheel}
            E .->|yes| F(["Build wheel"])
            E .->|no| C(["Install wheel"])
            F .-> C
            C .-> D["Target machine üñø"]
          -->
            <img width="95%" data-src="img/consume_package.svg" />
          </div>
        </section>

        <section>
          <h5>How to ship a source distribution?</h5>
          <img src="img/sdist.png" />
        </section>

        <section>
          <h5>What is a wheel?</h5>
          <pre style="font-size: 0.5em">
                <code class="lang-python" data-trim data-noescape>
                    <mark>
                    /Users/bernat/Library/Python/3.9/lib/python/site-packages/pugs
                    ‚îú‚îÄ‚îÄ __init__.py
                    ‚îú‚îÄ‚îÄ __pycache__
                    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.cpython-39.pyc
                    ‚îÇ   ‚îî‚îÄ‚îÄ logic.cpython-39.pyc
                    ‚îî‚îÄ‚îÄ logic.py

                    /Users/bernat/Library/Python/3.9/lib/python/site-packages/pugs-0.0.1.dist-info
                    ‚îú‚îÄ‚îÄ INSTALLER
                    ‚îú‚îÄ‚îÄ LICENSE.txt
                    ‚îú‚îÄ‚îÄ METADATA
                    ‚îú‚îÄ‚îÄ RECORD
                    ‚îú‚îÄ‚îÄ WHEEL
                    ‚îú‚îÄ‚îÄ top_level.txt
                    ‚îî‚îÄ‚îÄ zip-safe
                    </mark>
                </code>
            </pre>
        </section>

        <section>
          <h5>How to ship a wheel?</h5>
          <pre>
                <code class="lang-python" data-trim data-noescape>
                    pugs-project
                ‚îú‚îÄ‚îÄ .git
                ‚îú‚îÄ‚îÄ README.rst
                ‚îú‚îÄ‚îÄ setup.cfg
                ‚îú‚îÄ‚îÄ setup.py
                ‚îú‚îÄ‚îÄ LICENSE.txt
                ‚îú‚îÄ‚îÄ src
                ‚îÇ   ‚îî‚îÄ‚îÄ <mark>pugs
                ‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
                ‚îÇ       ‚îî‚îÄ‚îÄ logic.py</mark>
                ‚îú‚îÄ‚îÄ tests
                ‚îÇ   ‚îú‚îÄ‚îÄ test_init.py
                ‚îÇ   ‚îî‚îÄ‚îÄ test_logic.py
                ‚îú‚îÄ‚îÄ tox.ini
                ‚îî‚îÄ‚îÄ azure-pipelines.yml
                </code>
            </pre>
        </section>

        <section>
          <h5>What is a wheel?</h5>
          <pre style="font-size: 0.5em">
                <code class="lang-python" data-trim data-noescape>
                    <mark>
                    /Users/bernat/Library/Python/3.9/lib/python/site-packages/pugs
                    ‚îú‚îÄ‚îÄ __init__.py
                    ‚îú‚îÄ‚îÄ __pycache__
                    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.cpython-39.pyc
                    ‚îÇ   ‚îî‚îÄ‚îÄ logic.cpython-39.pyc
                    ‚îî‚îÄ‚îÄ logic.py

                    /Users/bernat/Library/Python/3.9/lib/python/site-packages/pugs-0.0.1.dist-info
                    ‚îú‚îÄ‚îÄ INSTALLER
                    ‚îú‚îÄ‚îÄ LICENSE.txt
                    ‚îú‚îÄ‚îÄ METADATA
                    ‚îú‚îÄ‚îÄ RECORD
                    ‚îú‚îÄ‚îÄ WHEEL
                    ‚îú‚îÄ‚îÄ top_level.txt
                    ‚îî‚îÄ‚îÄ zip-safe
                    </mark>
                </code>
            </pre>
        </section>

        <section>
          <h5>wheel</h5>
          <img src="img/wheel.png" />
        </section>

        <section>
          <h5>generate wheel - <a href="https://www.python.org/dev/peps/pep-0427/">PEP 427</a></h5>

          <ul>
            <li>select and copy python files</li>
            <li class="fragment">
              generate metadata - <a href="https://www.python.org/dev/peps/pep-0396/">PEP 396</a>
            </li>
            <li class="fragment">generate pyc files</li>
            <li class="fragment">
              generate binary library if c-extension package (C/CPP files)
              <ul>
                <li>get C/C++ toolchain (compiler, dependencies, libraries, etc)</li>
              </ul>
            </li>
            <li class="fragment">
              compress it into a file named <a href="https://www.python.org/dev/peps/pep-0425/">PEP 425</a>
            </li>
          </ul>
          <pre class="fragment">
                <code class="lang-python" data-trim data-noescape>
                    <mark>
                    psutil-5.6.2-cp39-cp39m-win_amd64.whl
                    </mark>
                </code>
            </pre>
        </section>

        <section>
          <h5>generate wheel - <a href="https://www.python.org/dev/peps/pep-0427/">PEP 427</a></h5>
          <ul>
            <li>select and copy python files <span style="color: red"> - requires correct setuptools version</span></li>
            <li class="fragment">
              generate metadata - <a href="https://www.python.org/dev/peps/pep-0396/">PEP 396</a>
              <span style="color: red"> - requires correct wheels version</span>
            </li>
            <li class="fragment">
              generate pyc files <span style="color: red"> - requires correct python version</span>
            </li>
            <li class="fragment">
              generate binary library if c-extension package (C/CPP files)
              <ul>
                <li>get C/C++ toolchain (compiler, dependencies, libraries, etc)</li>
              </ul>
            </li>
            <li class="fragment">
              compress it into a file named <a href="https://www.python.org/dev/peps/pep-0425/">PEP 425</a>
              <span style="color: red"> - requires correct wheels version</span>
            </li>
          </ul>
          <pre class="fragment">
                <code class="lang-python" data-trim data-noescape>
                    <mark>
                    psutil-5.6.2-cp39-cp39m-win_amd64.whl
                    </mark>
                </code>
            </pre>
        </section>

        <section>
          <h5>Why?</h5>

          <p>if version 41.0.0 setuptools adds <i>collect_magic_files</i></p>
          <pre style="max-width: 800px">
                <code class="lang-python" data-trim data-noescape>
                    from setuptools import setup
                    setup(collect_magic_files=True)
                </code>
            </pre>
          <p class="fragment">running with version 40.0.0 will not work</p>
        </section>

        <section>
          <h5>buckle up for a bit of history</h5>
          <figure style="font-size: 12px">
            <img style="max-height: 600px" src="img/photo-1541364983171-a8ba01e95cfc.jpeg" />
            <figcaption>
              Photo by
              <a
                href="https://unsplash.com/@charlesdeluvio?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit"
                >Charles üáµüá≠</a
              >
              /
              <a href="https://unsplash.com/?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit"
                >Unsplash</a
              >
              - ehhh
            </figcaption>
          </figure>
        </section>

        <section>
          <h5>History of packaging</h5>
          <ul>
            <li>2000 - Python 1.6 - distutils - setup.py introduced</li>
            <li class="fragment">2004 - setuptools - quickly became de facto standard</li>
            <li class="fragment">2008 - pip (replaces easy_install)</li>
            <li class="fragment">2014 - wheels</li>
            <li class="fragment">setuptools/wheels - setup.py arbitrary user code</li>
            <li class="fragment">
              2015 - flit - declarative over dynamic (arbitrary code run)
              <ul>
                <li class="fragment">easier to understand</li>
                <li class="fragment">harder to get wrong</li>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h5>How does a build work? - sdist - developer machine</h5>

          <ul>
            <li>
              on the source tree invoke the command
              <pre style="max-width: 800px; font-size: 15px">
                    <code class="lang-python" data-trim data-noescape>
                        python setup.py sdist
                    </code>
                    </pre>
            </li>

            <li>
              upload to pypi
              <pre style="max-width: 800px; font-size: 15px">
                    <code class="lang-python" data-trim data-noescape>
                        python setup.py upload
                        # http connection - post
                    </code>
                    </pre>
            </li>
          </ul>
        </section>

        <section>
          <h5>How does a build work? - sdist - developer machine</h5>

          <ul>
            <li>
              on the source tree invoke the command
              <pre style="max-width: 800px; font-size: 15px">
                    <code class="lang-python" data-trim data-noescape>
                        python setup.py sdist
                    </code>
                    </pre>
            </li>

            <li style="text-decoration: line-through">
              upload to pypi
              <pre style="max-width: 800px; font-size: 15px">
                    <code class="lang-python" data-trim data-noescape>
                        python setup.py upload
                        # http connection - post
                    </code>
                    </pre>
            </li>
          </ul>
        </section>

        <section>
          <h5>How does a build work? - sdist - developer machine</h5>

          <ul>
            <li>
              on the source tree invoke the command
              <pre style="max-width: 800px; font-size: 15px">
                    <code class="lang-python" data-trim data-noescape>
                        python setup.py sdist
                    </code>
                    </pre>
            </li>

            <li>
              upload to pypi
              <pre style="max-width: 800px; font-size: 15px">
                    <code class="lang-python" data-trim data-noescape>
                        <mark>twine upload package-sdist.targ.gz</mark>
                        # http<mark>s</mark> connection - post - guaranteed
                    </code>
                    </pre>
            </li>
          </ul>
        </section>

        <section>
          <h5>How does a build work? - sdist - user machine</h5>

          <ul>
            <pre style="max-width: 800px">
                <code class="lang-python" data-trim data-noescape>
                    pip install pugs==1.0.0
                </code>
            </pre>

            <li class="fragment">discover the package from PyPi</li>
            <li class="fragment">download the sdist and extract it</li>
            <li class="fragment">
              invoke setuptools to perform the install
              <pre style="max-width: 800px; font-size: 15px">
                <code class="lang-python" data-trim data-noescape>
                    python setup.py install
                </code>
            </pre>
            </li>
          </ul>
        </section>

        <section>
          <h5>Problem 1 - build dependencies</h5>
          <ul>
            <li>
              setuptools pulled in from the builder python
              <pre style="max-width: 800px; font-size: 15px">
                <code class="lang-python" data-trim data-noescape>
                    <mark>python</mark> setup.py sdist
                    <mark>python</mark> setup.py install
                </code>
            </pre>
            </li>
            <li class="fragment">
              cryptic error if build dependencies are missing
              <pre style="max-width: 800px; font-size: 15px">
                        <code class="lang-python" data-trim data-noescape>
                                  File "setup_build.py", line 99, in run
                                        from Cython.Build import cythonize
                                    ImportError: No module named Cython.Build
                        </code>
                    </pre>
            </li>
            <li class="fragment">or even worse no error - incorrect version</li>
            <li class="fragment">or even worse - user can hijack setuptools and try to inject their own code</li>
          </ul>
        </section>

        <section>
          <h5>Problem 1 - build dependencies</h5>
          <p style="margin: 0">Idea: declarative build environment provision</p>
          <pre style="max-width: 800px; font-size: 15px; max-height: 50px">
                <code class="lang-python" data-trim data-noescape>
                    python setup.py install
                </code>
                </pre>
          <ul>
            <li>create temporary folder</li>
            <li class="fragment">
              create an isolated python environment
              <pre style="max-width: 800px; font-size: 15px; max-height: 50px">
                <code class="lang-python" data-trim data-noescape>
                    python -m virtualenv our_build_env
                </code>
                </pre>
            </li>
            <li class="fragment">
              install build dependencies
              <pre style="max-width: 800px; font-size: 15px; max-height: 50px">
                <code class="lang-python" data-trim data-noescape>
                    our_build_env/bin/python -m pip dep1 dep2
                </code>
                </pre>
            </li>
            <li class="fragment">
              generate a wheel, that we can simply install afterwards
              <pre style="max-width: 800px; font-size: 15px; max-height: 50px">
                <code class="lang-python" data-trim data-noescape>
                    our_build_env/bin/python setup.py bdist_wheel
                </code>
                </pre>
            </li>
          </ul>
        </section>

        <section>
          <h5>Problem 1 - build dependencies</h5>

          <ul>
            <li><a href="https://www.python.org/dev/peps/pep-0518/">PEP-518</a></li>
            <li>
              specify deps via pyproject.toml
              <pre style="max-width: 800px; font-size: 15px">
                <code class="lang-python" data-trim data-noescape>
                    [build-system]
                    requires = [
                        "setuptools >= 40.8.0",
                        "wheel >= 0.30.0",
                        "cython >= 0.29.4",
                    ]
                </code>
                </pre>
            </li>
            <li class="fragment">
              TOML - Tom's Obvious, Minimal Language.
              <ul>
                <li>standardized</li>
                <li>not overly complex</li>
                <li>does not conflict with other files out there - setup.cfg</li>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h5>Problem 1 - build dependencies</h5>
          <ul>
            <li><a href="https://www.python.org/dev/peps/pep-0518/">PEP-518</a></li>
            <li>
              <b>build backend</b> - performs the package generation in an isolated environment
              <ul>
                <li>setuptools</li>
                <li>flit</li>
                <li>poetry</li>
              </ul>
            </li>
            <li class="fragment">
              <b>build frontend</b> - prepares the isolated environment, and invokes the backend
              <ul>
                <li>pip - PEP-518 support with version 18.0</li>
                <li>tox - PEP-518 support with version 3.3.0</li>
                <li>poetry</li>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h5>yay</h5>
          <figure style="font-size: 12px">
            <img style="max-height: 600px" src="img/photo-1512723185835-0700e5069a9a.jpeg" />
            <figcaption>
              Photo by
              <a
                href="https://unsplash.com/@star2dev?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit"
                >Bruce Galpin</a
              >
              /
              <a href="https://unsplash.com/?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit"
                >Unsplash</a
              >
              - yay!
            </figcaption>
          </figure>
        </section>

        <section>
          <h5>Problem 2 - diversity - better user interface</h5>
          <ul>
            <li>
              PEP-518 involves still calling to setup.py
              <pre style="max-width: 800px; font-size: 15px">
                <code class="lang-python" data-trim data-noescape>
                    our_build_env/bin/python <mark>setup.py</mark> bdist_wheel
                </code>
            </pre>
            </li>
            <li>setup.py allows arbitrary python code to run - cannot change due to backward compatibility</li>
            <li>flit implementation still involves generating setup.py and adhering to those limitations</li>
          </ul>
        </section>

        <section>
          <h5>Problem 2 - diversity - better user interface</h5>
          <ul>
            <li><a href="https://www.python.org/dev/peps/pep-0517/">PEP-517</a></li>
            <li>
              So instead of:
              <pre style="max-width: 700px; font-size: 15px">
                        <code class="lang-python" data-trim data-noescape>
                            our_build_env/bin/python <mark>setup.py</mark> bdist_wheel
                        </code>
                    </pre>
            </li>
            <li>
              Allow build backends to expose invocation end-points:
              <pre style="max-width: 700px; font-size: 15px">
                        <code class="lang-python" data-trim data-noescape>
                            [build-system]
                            requires = ["flit"]
                            build-backend = "flit.api:main"
                        </code>
                    </pre>
            </li>
            <li>
              And the build frontend will now do:
              <pre style="max-width: 700px; font-size: 15px">
                        <code class="lang-python" data-trim data-noescape>
                            import flit.api
                            backend = flit.api.main

                            backend.build_wheel()  # build wheel via
                            backend.build_sdist()  # build source distribution via
                        </code>
                    </pre>
            </li>
          </ul>
        </section>

        <section>
          <h5>Problem 2 - diversity - better user interface</h5>
          <ul>
            <li><a href="https://www.python.org/dev/peps/pep-0517/">PEP-517</a></li>
            <li>
              So instead of:
              <pre style="max-width: 700px; font-size: 15px">
                        <code class="lang-python" data-trim data-noescape>
                            our_build_env/bin/python <mark>setup.py</mark> bdist_wheel
                        </code>
                    </pre>
            </li>
            <li>
              Allow build backends to expose invocation end-points:
              <pre style="max-width: 700px; font-size: 15px">
                        <code class="lang-python" data-trim data-noescape>
                            [build-system]
                            requires = ["flit"]
                            build-backend = "<mark>flit.api</mark>:main"
                        </code>
                    </pre>
            </li>
            <li>
              And the build frontend will now do:
              <pre style="max-width: 700px; font-size: 15px">
                        <code class="lang-python" data-trim data-noescape>
                            import <mark>flit.api</mark>
                            backend = <mark>flit.api.main</mark>

                            backend.build_wheel()  # build wheel via
                            backend.build_sdist()  # build source distribution via
                        </code>
                    </pre>
            </li>
          </ul>
        </section>
        <section>
          <h5>Problem 2 - diversity - better user interface</h5>
          <ul>
            <li><a href="https://www.python.org/dev/peps/pep-0517/">PEP-517</a></li>
            <li>
              So instead of:
              <pre style="max-width: 700px; font-size: 15px">
                        <code class="lang-python" data-trim data-noescape>
                            our_build_env/bin/python <mark>setup.py</mark> <mark>bdist_wheel</mark>
                        </code>
                    </pre>
            </li>
            <li>
              Allow build backends to expose invocation end-points:
              <pre style="max-width: 700px; font-size: 15px">
                        <code class="lang-python" data-trim data-noescape>
                            [build-system]
                            requires = ["flit"]
                            build-backend = "<mark>flit.api</mark>:main"
                        </code>
                    </pre>
            </li>
            <li>
              And the build frontend will now do:
              <pre style="max-width: 700px; font-size: 15px">
                        <code class="lang-python" data-trim data-noescape>
                            import <mark>flit.api</mark>
                            backend = <mark>flit.api.main</mark>

                            <mark>backend.build_wheel</mark>()  # build wheel via
                            backend.build_sdist()  # build source distribution via
                        </code>
                    </pre>
            </li>
          </ul>
        </section>

        <section>
          <h5>Problem 2 - diversity - better user interface</h5>
          <ul>
            <li>
              <a href="https://www.python.org/dev/peps/pep-0517/">PEP-517</a> backend support
              <ul>
                <li>setuptools - <i>setuptools.build_meta</i> - version 40.8+</li>
                <li class="fragment">flit - <i>flit.buildapi</i></li>
                <li class="fragment">poetry - <i>poetry.masonry.api</i> - version 0.12.11</li>
              </ul>
            </li>
            <li class="fragment">
              <a href="https://www.python.org/dev/peps/pep-0517/">PEP-517</a> frontend support
              <ul>
                <li>pip 19.0</li>
                <li>tox 3.3.0</li>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h5>Caveats</h5>
          <ul>
            <li class="fragment">No editable install support yet</li>
            <li class="fragment">requires fairly new pip</li>
            <ul class="fragment">
              <li>on developer machine - if wheel distribution</li>
              <li class="fragment">on user machine - if source distribution</li>
            </ul>
          </ul>
        </section>

        <section>
          <h5>Build dependencies - developer machine</h5>
          <ul>
            <li>pip build command planned, for now <a href="https://pypi.org/project/pep517/">pep517 package</a></li>
            <li class="fragment">
              to build a <i><b>wheel</b></i> going forward use the following command:
              <pre style="max-width: 1024px; font-size: 15px">
                    <code class="lang-python" data-trim data-noescape>
                    <mark>python -m pep517.build --binary --out-dir /tmp/build-to .</mark>
                    # old -> python setup.py bdist_wheel
                </code>
                    </pre>
            </li>
            <li class="fragment">
              to build a <i><b>sdist</b></i> going forward use the following command:
              <pre style="max-width: 1024px; font-size: 15px">
                    <code class="lang-python" data-trim data-noescape>
                    <mark>python -m pep517.build --source --out-dir /tmp/build-to .</mark>
                    # old -> python setup.py sdist
                </code>
                    </pre>
            </li>
          </ul>
        </section>

        <section>
          <h5>Benefits</h5>
          <ul>
            <li class="fragment">Reproducible declarative builds</li>
            <li class="fragment">No more need for <i>setup.py</i></li>
            <li class="fragment" style="color: red">simpler packaging that fails less often</li>
          </ul>
        </section>

        <section>
          <h5>tox</h5>
          <figure style="font-size: 12px">
            <img style="max-width: 900px; max-height: 800px" src="img/sad.jpeg" />
            <figcaption>
              Photo by
              <a
                href="https://unsplash.com/@matthewhenry?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit"
                >Matthew Henry</a
              >
              /
              <a href="https://unsplash.com/?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit"
                >Unsplash</a
              >
              - no free lunch here, yet!
            </figcaption>
          </figure>
        </section>

        <section>
          <h5>tox</h5>
          <ul>
            <li>Not implicitly activated (version 4 probably will have it)</li>
            <li>
              add
              <pre style="max-width: 700px; font-size: 15px">
                        <code class="lang-python" data-trim data-noescape>
                            [tox]
                            isolated_build = True
                        </code>
                    </pre>
            </li>
            <li>during the packaging phase the source distribution will be built inside an isolated env</li>
            <li>
              RIP
              <pre style="max-width: 700px; font-size: 15px">
                        <code class="lang-python" data-trim data-noescape>
                            python setup.py sdist
                        </code>
                    </pre>
            </li>
          </ul>
        </section>

        <section>
          <h5>summary</h5>
          <ul style="margin-bottom: 15px">
            <li>PEP-518 - ensures declarative and reproducible build environments</li>
            <li class="fragment">PEP-517 - ensures we no longer build on top of old/legacy setup.py infrastructure</li>
          </ul>

          <br />
          <figure class="fragment" style="font-size: 12px">
            <img style="max-height: 450px" src="img/yay.jpeg" />
            <figcaption>
              Photo by
              <a
                href="https://unsplash.com/@yoadsh?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit"
                >Yoad Shejtman</a
              >
              /
              <a href="https://unsplash.com/?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit"
                >Unsplash</a
              >
            </figcaption>
          </figure>
        </section>

        <section>
          <h1>thank you</h1>
          <div>
            <img data-src="img/thats_all_folks.webp" style="margin-bottom: 0; border-bottom: 0; width: 50%" />
            <p style="font-size: 12px; margin: 0 0">
              <a href="https://commonhttps.wikimedia.org/wiki/File:Common_Seal_Phoca_vitulina.jpg"
                >&copy; Creative Commons Attribution-Share Alike 2.5 Generic</a
              >
            </p>
          </div>
          <p>
            <a href="https://www.bernat.tech/the-state-of-type-hints-in-python/"
              >https://www.bernat.tech/the-state-of-type-hints-in-python/</a
            >
          </p>
        </section>
      </div>
    </div>
    <script src="dist/reveal.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script src="plugin/math/math.js"></script>
    <script>
      Reveal.initialize({
        width: 1920,
        height: 1080,
        margin: 0.01,
        minScale: 0.2,
        maxScale: 2.0,
        hash: true,
        transition: "none",
        history: true,
        progress: false,
        controls: false,
        controlsTutorial: false,
        plugins: [RevealHighlight, RevealMath],
        math: {
          mathjax: "https://cdn.jsdelivr.net/gh/mathjax/mathjax@2.7.8/MathJax.js",
          config: "TeX-AMS_HTML-full",
          TeX: { Macros: { RR: "{\\bf R}" } },
        },
      });
    </script>
  </body>
</html>
